# üè¢ Meeting Room Booking ‚Äî Backend

A production-ready Node.js + Express REST API with SQLite database.
The frontend is a single-page app served by the same server.

---

## üìÅ Project Structure

```
mrb-backend/
‚îú‚îÄ‚îÄ server.js              ‚Üê Entry point
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ render.yaml            ‚Üê Render.com deployment config
‚îú‚îÄ‚îÄ .env.example           ‚Üê Copy to .env for local dev
‚îú‚îÄ‚îÄ .gitignore
‚îÇ
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îî‚îÄ‚îÄ database.js        ‚Üê SQLite schema + seeding
‚îÇ
‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îî‚îÄ‚îÄ auth.js            ‚Üê JWT verification
‚îÇ
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ auth.js            ‚Üê Login, change-password, /me
‚îÇ   ‚îú‚îÄ‚îÄ users.js           ‚Üê CRUD users (admin + self-edit)
‚îÇ   ‚îú‚îÄ‚îÄ rooms.js           ‚Üê CRUD rooms + availability
‚îÇ   ‚îú‚îÄ‚îÄ bookings.js        ‚Üê Create, approve, reject, cancel
‚îÇ   ‚îú‚îÄ‚îÄ notifications.js   ‚Üê Read/mark notifications
‚îÇ   ‚îú‚îÄ‚îÄ analytics.js       ‚Üê Dashboard stats + export data
‚îÇ   ‚îî‚îÄ‚îÄ settings.js        ‚Üê EmailJS config stored in DB
‚îÇ
‚îî‚îÄ‚îÄ public/
    ‚îî‚îÄ‚îÄ index.html         ‚Üê Full frontend (API-connected)
```

---

## üñ•Ô∏è Run Locally

### 1. Install Node.js (v18+)
Download from https://nodejs.org

### 2. Setup project

```bash
cd mrb-backend
npm install
cp .env.example .env
```

### 3. Edit `.env`

```env
PORT=3000
JWT_SECRET=your_long_random_secret_here
ADMIN_EMAIL=admin@company.com
ADMIN_PASSWORD=admin@123
```

### 4. Start the server

```bash
npm start
# or for auto-restart on changes:
npm run dev
```

### 5. Open browser

Go to **http://localhost:3000**

Login with your admin credentials from `.env`.

---

## üöÄ Deploy to Render.com (Free Hosting ‚Äî Recommended)

### Step 1 ‚Äî Push to GitHub

```bash
# In the mrb-backend folder:
git init
git add .
git commit -m "Initial commit"
```

Create a repo on https://github.com/new, then:

```bash
git remote add origin https://github.com/YOUR_USERNAME/meeting-room-booking.git
git push -u origin main
```

### Step 2 ‚Äî Create Render account

Go to https://render.com and sign up for free.

### Step 3 ‚Äî New Web Service

1. Click **"New +"** ‚Üí **"Web Service"**
2. Connect your GitHub account
3. Select your `meeting-room-booking` repository
4. Render will auto-detect the `render.yaml` ‚Äî click **"Apply"**

### Step 4 ‚Äî Set Environment Variables

In Render dashboard ‚Üí your service ‚Üí **Environment**:

| Key | Value |
|-----|-------|
| `ADMIN_EMAIL` | your-admin@company.com |
| `ADMIN_PASSWORD` | YourSecurePassword123 |

> `JWT_SECRET` is auto-generated by Render (secure ‚úÖ)

### Step 5 ‚Äî Deploy

Click **"Save Changes"** ‚Üí Render builds and deploys automatically.

Your app will be live at:
```
https://meeting-room-booking.onrender.com
```

> ‚ö†Ô∏è Free tier spins down after 15 min of inactivity ‚Äî first load may take ~30s.

---

## üåê API Reference

All endpoints are prefixed with `/api/`.
Protected routes require: `Authorization: Bearer <token>`

### Auth
| Method | Path | Auth | Description |
|--------|------|------|-------------|
| POST | `/auth/login` | ‚ùå | Login, returns JWT token |
| GET | `/auth/me` | ‚úÖ | Get current user info |
| POST | `/auth/change-password` | ‚úÖ | Change own password |

### Users
| Method | Path | Auth | Description |
|--------|------|------|-------------|
| GET | `/users` | Admin | List all users |
| GET | `/users/:id` | ‚úÖ | Get user (self or admin) |
| POST | `/users` | Admin | Create user |
| PATCH | `/users/:id` | ‚úÖ | Edit user (limited fields for self) |
| PATCH | `/users/:id/toggle-active` | Admin | Activate/deactivate |
| PATCH | `/users/:id/reset-password` | Admin | Reset password |
| DELETE | `/users/:id` | Admin | Delete user |

### Rooms
| Method | Path | Auth | Description |
|--------|------|------|-------------|
| GET | `/rooms` | ‚úÖ | List all rooms |
| GET | `/rooms/:id/availability?date=YYYY-MM-DD` | ‚úÖ | Hourly slot availability |
| POST | `/rooms` | Admin | Create room |
| PATCH | `/rooms/:id` | Admin | Edit room |
| PATCH | `/rooms/:id/toggle-block` | Admin | Block/unblock |
| DELETE | `/rooms/:id` | Admin | Delete room |

### Bookings
| Method | Path | Auth | Description |
|--------|------|------|-------------|
| GET | `/bookings` | ‚úÖ | My bookings (admin: all) |
| GET | `/bookings/pending-count` | Admin | Count for sidebar badge |
| GET | `/bookings/:id` | ‚úÖ | Single booking |
| POST | `/bookings` | ‚úÖ | Create booking |
| PATCH | `/bookings/:id/cancel` | ‚úÖ | Cancel booking |
| PATCH | `/bookings/:id/approve` | Admin | Approve pending |
| PATCH | `/bookings/:id/reject` | Admin | Reject with reason |

### Notifications
| Method | Path | Auth | Description |
|--------|------|------|-------------|
| GET | `/notifications` | ‚úÖ | Get notifications + unread count |
| PATCH | `/notifications/mark-all-read` | ‚úÖ | Mark all as read |

### Analytics & Export
| Method | Path | Auth | Description |
|--------|------|------|-------------|
| GET | `/analytics/summary` | Admin | Stats for charts |
| GET | `/analytics/export` | Admin | All rows for CSV/Excel |

### Settings
| Method | Path | Auth | Description |
|--------|------|------|-------------|
| GET | `/settings` | Admin | Get all settings (EmailJS config) |
| PUT | `/settings` | Admin | Save settings |

---

## üîí Security Notes

- Passwords hashed with bcrypt (10 rounds)
- JWT tokens expire after 8 hours
- Admin-only routes are enforced server-side
- SQLite WAL mode for safe concurrent access
- CORS configured via environment variable

---

## üìß Email Notifications (EmailJS)

After deploying, go to **Email Settings** in the app sidebar:

1. Create free account at https://emailjs.com
2. Add email service (Gmail/Outlook)
3. Create email template using variables:
   - `{{booked_by}}`, `{{room_name}}`, `{{meeting_date}}`
   - `{{start_time}}`, `{{end_time}}`, `{{food}}`, `{{veg_nonveg}}`
   - `{{status}}`, `{{purpose}}`, `{{remarks}}`
4. Copy Service ID, Template ID, Public Key
5. Paste into Email Settings in the app ‚Üí Save

---

## üõ†Ô∏è Tech Stack

| Layer | Technology |
|-------|------------|
| Runtime | Node.js 18+ |
| Framework | Express 4 |
| Database | SQLite (better-sqlite3) |
| Auth | JWT (jsonwebtoken) |
| Passwords | bcryptjs |
| Frontend | Vanilla JS SPA |
| Charts | Chart.js |
| Excel | SheetJS (xlsx) |
| Email | EmailJS |
